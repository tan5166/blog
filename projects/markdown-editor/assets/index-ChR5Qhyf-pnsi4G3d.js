import{c as E}from"./confirm-DtE-HkVd-CQtly_A8.js";import{c as A,i as O,a as D,b as F}from"./image-DoB1o1sl-BigajxiF.js";import{$ as H,a as M,i as V}from"./index-z4CAFi_O.js";import{r as m,c as z,d as L,w as N,p as j,h as r,b as P}from"./purify.es-CuyYui_p.js";var $=Object.defineProperty,B=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,q=(t,e,l)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l,G=(t,e)=>{for(var l in e||(e={}))W.call(e,l)&&q(t,l,e[l]);if(B)for(var l of B(e))K.call(e,l)&&q(t,l,e[l]);return t};function S(t,e){return Object.assign(t,{meta:G({package:"@milkdown/components"},e)}),t}const J={imageIcon:()=>"🌌",uploadButton:()=>"Upload",confirmButton:()=>"⏎",uploadPlaceholderText:"/Paste",onUpload:t=>Promise.resolve(URL.createObjectURL(t))},w=H(J,"inlineImageConfigCtx");S(w,{displayName:"Config<image-inline>",group:"ImageInline"});function C({icon:t,class:e,onClick:l}){return r("span",{class:P("milkdown-icon",e),onPointerdown:l,ref:u=>{u&&t&&(u.innerHTML=j.sanitize(t.trim()))}})}C.props={icon:{type:String,required:!1},class:{type:String,required:!1},onClick:{type:Function,required:!1}};const Q=A("abcdefg",8),X=L({props:{src:{type:Object,required:!0},selected:{type:Object,required:!0},readonly:{type:Object,required:!0},setLink:{type:Function,required:!0},imageIcon:{type:String,required:!1},uploadButton:{type:String,required:!1},confirmButton:{type:String,required:!1},uploadPlaceholderText:{type:String,required:!1},onUpload:{type:Function,required:!0}},setup({readonly:t,src:e,setLink:l,onUpload:u,imageIcon:n,uploadButton:i,confirmButton:d,uploadPlaceholderText:s,className:v}){var p,y;const f=m(!1),c=m(),U=m((p=e.value)!=null?p:""),k=m(Q()),b=m(((y=e.value)==null?void 0:y.length)!==0),a=o=>{const I=o.target.value;b.value=I.length!==0,U.value=I},h=o=>{var g,I;o.key==="Enter"&&l((I=(g=c.value)==null?void 0:g.value)!=null?I:"")},_=()=>{var o,g;l((g=(o=c.value)==null?void 0:o.value)!=null?g:"")},R=o=>{var g;const I=(g=o.target.files)==null?void 0:g[0];I&&u(I).then(x=>{x&&(l(x),b.value=!0)}).catch(x=>{console.error("An error occurred while uploading image"),console.error(x)})};return()=>r("div",{class:P("image-edit",v)},r(C,{icon:n,class:"image-icon"}),r("div",{class:P("link-importer",f.value&&"focus")},r("input",{ref:c,draggable:"true",onDragstart:o=>{o.preventDefault(),o.stopPropagation()},disabled:t.value,class:"link-input-area",value:U.value,onInput:a,onKeydown:h,onFocus:()=>f.value=!0,onBlur:()=>f.value=!1}),!b.value&&r("div",{class:"placeholder"},r("input",{disabled:t.value,class:"hidden",id:k.value,type:"file",accept:"image/*",onChange:R}),r("label",{class:"uploader",for:k.value},r(C,{icon:i})),r("span",{class:"text",onClick:()=>{var o;return(o=c.value)==null?void 0:o.focus()}},s))),U.value&&r("div",{class:"confirm",onClick:()=>_()},r(C,{icon:d})))}}),Y=L({props:{src:{type:Object,required:!0},alt:{type:Object,required:!0},title:{type:Object,required:!0},selected:{type:Object,required:!0},readonly:{type:Object,required:!0},setAttr:{type:Function,required:!0},config:{type:Object,required:!0}},setup(t){const{src:e,alt:l,title:u}=t;return()=>{var n;return(n=e.value)!=null&&n.length?r("img",{class:"image-inline",src:e.value,alt:l.value,title:u.value}):r(X,{src:t.src,selected:t.selected,readonly:t.readonly,setLink:i=>t.setAttr("src",i),imageIcon:t.config.imageIcon(),uploadButton:t.config.uploadButton(),confirmButton:t.config.confirmButton(),uploadPlaceholderText:t.config.uploadPlaceholderText,onUpload:t.config.onUpload,className:"empty-image-inline"})}}}),T=M(V.node,t=>(e,l,u)=>{const n=m(e.attrs.src),i=m(e.attrs.alt),d=m(e.attrs.title),s=m(!1),v=m(!l.editable),p=(a,h)=>{const _=u();_!=null&&l.dispatch(l.state.tr.setNodeAttribute(_,a,a==="src"?j.sanitize(h):h))},y=t.get(w.key),f=z(Y,{src:n,alt:i,title:d,selected:s,readonly:v,setAttr:p,config:y}),c=document.createElement("span");c.className="milkdown-image-inline",f.mount(c);const U=N(()=>{s.value?c.classList.add("selected"):c.classList.remove("selected")}),k=y.proxyDomURL,b=a=>{if(!k)n.value=a.attrs.src;else{const h=k(a.attrs.src);typeof h=="string"?n.value=h:h.then(_=>{n.value=_}).catch(console.error)}i.value=a.attrs.alt,d.value=a.attrs.title};return b(e),{dom:c,update:a=>a.type!==e.type?!1:(b(a),!0),stopEvent:a=>a.target instanceof HTMLInputElement,selectNode:()=>{s.value=!0},deselectNode:()=>{s.value=!1},destroy:()=>{U(),f.unmount(),c.remove()}}});S(T,{displayName:"NodeView<image-inline>",group:"ImageInline"});const Z=[w,T],ee=`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="32"
    height="32"
    viewBox="0 0 24 24"
  >
    <path
      fill="currentColor"
      d="M9 22a1 1 0 0 1-1-1v-3H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6.1l-3.7 3.71c-.2.19-.45.29-.7.29zm1-6v3.08L13.08 16H20V4H4v12z"
    />
  </svg>
`,oe=(t,e)=>{t.config(l=>{l.update(w.key,u=>{var n,i,d,s,v,p;return{uploadButton:(n=e==null?void 0:e.inlineUploadButton)!=null?n:()=>"Upload",imageIcon:(i=e==null?void 0:e.inlineImageIcon)!=null?i:()=>O,confirmButton:(d=e==null?void 0:e.inlineConfirmButton)!=null?d:()=>E,uploadPlaceholderText:(s=e==null?void 0:e.inlineUploadPlaceholderText)!=null?s:"or paste link",onUpload:(p=(v=e==null?void 0:e.inlineOnUpload)!=null?v:e==null?void 0:e.onUpload)!=null?p:u.onUpload,proxyDomURL:e==null?void 0:e.proxyDomURL}}),l.update(D.key,u=>{var n,i,d,s,v,p,y,f;return{uploadButton:(n=e==null?void 0:e.blockUploadButton)!=null?n:()=>"Upload file",imageIcon:(i=e==null?void 0:e.blockImageIcon)!=null?i:()=>O,captionIcon:(d=e==null?void 0:e.blockCaptionIcon)!=null?d:()=>ee,confirmButton:(s=e==null?void 0:e.blockConfirmButton)!=null?s:()=>"Confirm",captionPlaceholderText:(v=e==null?void 0:e.blockCaptionPlaceholderText)!=null?v:"Write Image Caption",uploadPlaceholderText:(p=e==null?void 0:e.blockUploadPlaceholderText)!=null?p:"or paste link",onUpload:(f=(y=e==null?void 0:e.blockOnUpload)!=null?y:e==null?void 0:e.onUpload)!=null?f:u.onUpload,proxyDomURL:e==null?void 0:e.proxyDomURL}})}).use(F).use(Z)};export{oe as defineFeature};
